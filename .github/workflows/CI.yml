name: CI

on:
    push:
        branches:
            - main
    pull_request:

jobs:
    lint:
        runs-on: ubuntu-latest
        container: node:22
        steps:
            - uses: actions/checkout@v4

            - run: npm i
            - run: npm run lint
            - run: npm run format

    playwright:
        runs-on: ubuntu-latest
        container: mcr.microsoft.com/playwright:v1.50.0-jammy
        env:
            HOME: /root
        steps:
            - uses: actions/checkout@v4

            - run: npm i
            - run: npm run test:coverage

            - name: Produce the coverage report
              uses: insightsengineering/coverage-action@v2
              with:
                  path: coverage/cobertura-coverage.xml
                  threshold: 80
                  fail: true
                  # Publish the rendered output as a PR comment
                  publish: true
                  # Create a coverage diff report.
                  diff: true
                  # Branch to diff against.
                  # Compare the current coverage to the coverage
                  # determined on this branch.
                  diff-branch: main
                  # This is where the coverage reports for the
                  # `diff-branch` are stored.
                  diff-storage: _xml_coverage_reports
                  coverage-summary-title: 'Code Coverage Summary'
